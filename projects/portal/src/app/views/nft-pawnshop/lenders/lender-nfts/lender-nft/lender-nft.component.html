<div class="card lg:card-side bg-base-100 shadow-xl mb-8">
  <figure class="aspect-square w-1/2 lg:w-1/4">
    <!-- img width setting not working -->
    <img
      src="{{ nftImage || 'assets/UnUniFi-logo.png' }}"
      alt="image of the NFT"
      class="object-cover"
    />
  </figure>
  <div class="card-body w-2/3">
    <div class="flex flex-row">
      <div class="badge badge-lg badge-primary">{{ listingInfo?.state || 'NOT_LISTING' }}</div>
    </div>
    <h2 class="card-title break-all">
      {{ nftMetadata?.name || classID + '/' + nftID }}
    </h2>
    <div class="overflow-x-auto">
      <table class="table w-full">
        <tbody>
          <tr>
            <th>Class ID</th>
            <td>{{ classID }}</td>
          </tr>
          <tr>
            <th>NFT ID</th>
            <td>{{ nftID }}</td>
          </tr>
          <tr>
            <th>Minimum deposit rate</th>
            <td>{{ listingInfo?.minimum_deposit_rate | percentage }}</td>
          </tr>
          <tr>
            <th>Started at</th>
            <td>{{ listingInfo?.started_at | date : 'yyyy-MM-dd a hh:mm z' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="card bg-base-100 shadow-xl mb-8">
  <div class="card-body">
    <div class="flex flex-row items-center">
      <div class="stats stats-vertical md:stats-horizontal">
        <div class="stat" *ngIf="bidders && bidders.length">
          <div class="stat-title">Highest bid price</div>
          <div class="stat-value text-primary">
            {{ bidders[0].bid_amount?.amount | coinAmount }}
          </div>
          <div class="stat-desc">{{ bidders[0].bid_amount?.denom | coinDenom }}</div>
        </div>
        <div class="stat">
          <div class="stat-title">Your Status</div>
          <div *ngIf="!bidDetail" class="stat-value text-info">Not Offered</div>
          <div *ngIf="bidDetail" class="stat-value text-accent">Offered</div>
        </div>
        <div *ngIf="bidDetail && bidDetail.borrowings && bidDetail.borrowings.length" class="stat">
          <div class="stat-title">Lending Status</div>
          <div class="stat-value text-primary">{{ bidDetail.borrowings[0].amount | coin }}</div>
        </div>
        <div *ngIf="isWinning" class="stat">
          <div class="stat-title">Settlement Shortfall Deadline</div>
          <div class="stat-value text-accent">
            {{ listingInfo?.end_at | date : 'yyyy-MM-dd' }}
          </div>
          <div class="stat-desc">{{ listingInfo?.end_at | date : 'hh:mm:ss z' }}</div>
        </div>
      </div>
      <span class="flex-auto"></span>
      <div *ngIf="!bidDetail && !isWinning" class="card-actions justify-end">
        <button routerLink="place-bid" class="btn btn-primary px-8">Make Offer</button>
      </div>
      <div
        *ngIf="
          bidDetail &&
          !bidDetail.borrowings?.length &&
          !isWinning &&
          listingInfo?.state === 'BIDDING'
        "
        class="card-actions flex flex-row"
      >
        <button routerLink="place-bid" class="btn btn-primary px-8">Update Offer</button>
        <span class="flex-auto"></span>
        <button
          *ngIf="bidders && bidders.length > 1"
          class="btn btn-secondary px-8"
          (click)="onSubmitCancelBid()"
        >
          Cancel Offer
        </button>
      </div>
      <div *ngIf="isWinning" class="card-actions justify-end">
        <button class="btn btn-primary px-8" (click)="onSubmitPayFullBid()">
          Pay Settlement Shortfall
        </button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="bidders?.length" class="card bg-base-100 shadow-xl">
  <div class="overflow-x-auto">
    <table class="table w-full">
      <thead>
        <tr>
          <th></th>
          <td>Interest</td>
          <td>Deposit</td>
          <td>Bid price</td>
          <td>Expiry</td>
          <td>Bidder</td>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let bidder of bidders; let i = index">
          <ng-container
            *ngIf="bidder.bidder === currentStoredWallet?.address; then color; else normal"
          ></ng-container>
          <ng-template #color>
            <th class="text-secondary">#{{ i + 1 }}</th>
            <td class="text-secondary">{{ bidder.deposit_lending_rate | percentage }}</td>
            <td class="text-secondary">{{ bidder.deposit_amount | coin }}</td>
            <td class="text-secondary">{{ bidder.bid_amount | coin }}</td>
            <td class="text-secondary">
              {{ bidder.bidding_period | date : 'yyyy-MM-dd a hh:mm z' }}
            </td>
            <td class="text-secondary">{{ bidder.bidder }}</td>
          </ng-template>
          <ng-template #normal>
            <th>#{{ i + 1 }}</th>
            <td>{{ bidder.deposit_lending_rate | percentage }}</td>
            <td>{{ bidder.deposit_amount | coin }}</td>
            <td>{{ bidder.bid_amount | coin }}</td>
            <td>{{ bidder.bidding_period | date : 'yyyy-MM-dd a hh:mm z' }}</td>
            <td>{{ bidder.bidder }}</td>
          </ng-template>
        </tr>
      </tbody>
    </table>
  </div>
</div>
