<div class="flex flex-row flex-wrap">
  <h2 class="mb-0">Proposals</h2>
  <span class="flex-auto"></span>
  <div class="card bg-white text-base-content shadow-xl" *ngIf="(proposals?.length || 0) > 5">
    <div class="card-body">
      <h3 class="card-title -mb-2">Pagination</h3>
      <!-- To Do Pagination Change  -->
      <mat-paginator
        [length]="pageLength"
        [pageSize]="pageSize"
        [pageIndex]="pageNumber ? pageNumber - 1 : 0"
        [pageSizeOptions]="pageSizeOptions ? pageSizeOptions : []"
        (page)="onPaginationChange($event)"
      >
      </mat-paginator>
    </div>
  </div>
</div>

<div class="m-16">
  <div class="flex flex-row flex-wrap -mr-12 -mb-12">
    <ng-container *ngIf="proposals === null; then loading; else loaded"> </ng-container>
    <ng-template #loading>
      <mat-progress-spinner [diameter]="30" [mode]="'indeterminate'"></mat-progress-spinner>
    </ng-template>
    <ng-template #loaded>
      <ng-container *ngIf="(proposals?.length || 0) > 0; then exist; else empty"> </ng-container>
    </ng-template>

    <ng-template #exist>
      <div
        *ngFor="let proposal of proposals; let i = index"
        class="pr-12 pb-12 w-full md:w-1/2 xl:w-1/3"
      >
        <div class="indicator w-full">
          <span class="indicator-item badge badge-primary">
            {{ proposal.status?.replace('PROPOSAL_STATUS_', '') }}
          </span>
          <div class="card glass w-full shadow-xl">
            <div class="card-body">
              <h2 class="card-title break-all">
                # {{ proposal.proposal_id }} {{ unpackContent(proposal?.content).title }}
              </h2>
              <div class="divider m-0">Tallies</div>
              <div class="grid gap-3">
                <div class="flex items-center p-1 w-full">
                  <mat-icon class="w-8 text-success">thumb_up</mat-icon>
                  <progress
                    max="{{ tallies![i].max }}"
                    value="{{ tallies![i].yes }}"
                    class="progress progress-success"
                  ></progress>
                </div>
                <div class="flex items-center p-1">
                  <mat-icon class="w-8 text-warning">thumb_down</mat-icon>
                  <progress
                    max="{{ tallies![i].max }}"
                    value="{{ tallies![i].no }}"
                    class="progress progress-warning"
                  ></progress>
                </div>
                <div class="flex items-center p-1">
                  <mat-icon class="w-8 text-error">not_interested</mat-icon>
                  <progress
                    max="{{ tallies![i].max }}"
                    value="{{ tallies![i].noWithVeto }}"
                    class="progress progress-error"
                  ></progress>
                </div>
                <div class="flex items-center p-1">
                  <mat-icon class="w-8 text-primary">subtitles_off</mat-icon>
                  <progress
                    max="{{ tallies![i].max }}"
                    value="{{ tallies![i].abstain }}"
                    class="progress progress-primary"
                  ></progress>
                </div>
              </div>
              <div class="card-actions justify-end">
                <button
                  class="btn btn-outline btn-secondary px-4"
                  (click)="onClickVote(proposal.proposal_id!)"
                >
                  <mat-icon class="mr-2">how_to_vote</mat-icon>Vote
                </button>
                <button
                  class="btn btn-outline btn-info px-4"
                  routerLink="{{ proposal.proposal_id }}"
                >
                  View
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-template>
    <ng-template #empty>
      <p>There is no proposal.</p>
    </ng-template>
  </div>
</div>
