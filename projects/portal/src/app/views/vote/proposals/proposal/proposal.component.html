<ng-container *ngIf="proposal === null; then loading; else loaded"> </ng-container>
<ng-template #loading>
  <mat-progress-spinner [diameter]="60" [mode]="'indeterminate'"></mat-progress-spinner>
</ng-template>
<ng-template #loaded>
  <ng-container *ngIf="unpackContent(proposal?.content) as content">
    <div class="flex flex-row">
      <h2># {{ proposal?.proposal_id }} {{ content.title }}</h2>
      <span class="flex-auto"></span>
      <mat-chip-list>
        <mat-chip color="primary" selected>{{
          proposal?.status?.replace('PROPOSAL_STATUS_', '')
        }}</mat-chip>
      </mat-chip-list>
    </div>

    <h3>Details</h3>
    <mat-card class="mb-4">
      <mat-card-content>
        <mat-list>
          <mat-list-item>
            <span>Type </span>
            <span class="flex-auto"></span>
            <span>{{ proposalType?.replace('/cosmos.gov.v1beta1.', '') }}</span>
          </mat-list-item>
          <mat-divider [inset]="true"></mat-divider>
          <mat-list-item>
            <span>Submitted: </span>
            <span class="flex-auto"></span>
            <span>{{ proposal?.submit_time }}</span>
          </mat-list-item>
          <mat-divider [inset]="true"></mat-divider>
          <mat-list-item>
            <span>Start Voting: </span>
            <span class="flex-auto"></span>
            <span>{{ proposal?.voting_start_time }}</span>
          </mat-list-item>
          <mat-divider [inset]="true"></mat-divider>
          <mat-list-item>
            <span>End Voting: </span>
            <span class="flex-auto"></span>
            <span>{{ proposal?.voting_end_time }}</span>
          </mat-list-item>
          <mat-divider [inset]="true"></mat-divider>
          <mat-list-item>
            <span>Deposit End Time: </span>
            <span class="flex-auto"></span>
            <span>{{ proposal?.deposit_end_time }}</span>
          </mat-list-item>
        </mat-list>
      </mat-card-content>
    </mat-card>

    <h3>Description</h3>
    <mat-card class="mb-4">
      <mat-card-content>
        <span class="break-all">{{ content.description }}</span>
      </mat-card-content>
    </mat-card>
  </ng-container>

  <h3>Votes</h3>
  <mat-card class="mb-4">
    <mat-card-content>
      <mat-list>
        <mat-list-item>
          <span>Yes: </span>
          <span class="flex-auto"></span>
          <span>{{ tally?.yes }}</span>
        </mat-list-item>
        <mat-divider [inset]="true"></mat-divider>
        <mat-list-item>
          <span>No with Veto: </span>
          <span class="flex-auto"></span>
          <span>{{ tally?.no_with_veto }}</span>
        </mat-list-item>

        <mat-divider [inset]="true"></mat-divider>
        <mat-list-item>
          <span>No: </span>
          <span class="flex-auto"></span>
          <span>{{ tally?.no }}</span>
        </mat-list-item>
        <mat-divider [inset]="true"></mat-divider>
        <mat-list-item>
          <span>Abstain: </span>
          <span class="flex-auto"></span>
          <span>{{ tally?.abstain }}</span>
        </mat-list-item>
      </mat-list>
    </mat-card-content>
  </mat-card>

  <button class="w-full mb-4" mat-flat-button color="primary">
    <mat-icon>how_to_vote</mat-icon>
    <span>Vote</span>
  </button>

  <h3>deposits</h3>
  <h4>Total</h4>
  <mat-card class="mb-4">
    <mat-card-content>
      <mat-list>
        <ng-container *ngIf="!proposal?.total_deposit?.length">
          <span>No Deposit</span>
        </ng-container>
        <ng-container *ngFor="let total of proposal?.total_deposit">
          <mat-list-item>
            <span>{{ total.amount }}</span>
            <span class="flex-auto"></span>
            <span>{{ total.denom }}</span>
          </mat-list-item>
          <mat-divider [inset]="true"></mat-divider>
        </ng-container>
      </mat-list>
    </mat-card-content>
  </mat-card>

  <ng-container *ngFor="let deposit of deposits">
    <h4>Depositor: {{ deposit.depositor }}</h4>
    <mat-card class="mb-4">
      <mat-list>
        <ng-container *ngIf="!deposit.amount?.length">
          <span>No Deposit</span>
        </ng-container>
        <ng-container *ngFor="let amount of deposit.amount">
          <mat-list-item>
            <span>{{ amount.amount }}</span>
            <span class="flex-auto"></span>
            <span>{{ amount.denom }}</span>
          </mat-list-item>
          <mat-divider [inset]="true"></mat-divider>
        </ng-container>
      </mat-list>
    </mat-card>
  </ng-container>

  <button class="w-full mb-4" mat-flat-button color="primary">
    <mat-icon>add</mat-icon>
    <span>Deposit</span>
  </button>

  <ng-container *ngFor="let vote of votes">
    <h3>Vote</h3>
    <h4>voter: {{ vote.voter }}</h4>
    <mat-card>
      <mat-list>
        <mat-list-item>
          <span>Select: </span>
          <span class="flex-auto"></span>
          <span>{{ vote.option }}</span>
        </mat-list-item>
        <mat-divider [inset]="true"></mat-divider>
      </mat-list>
    </mat-card>
  </ng-container>
</ng-template>
