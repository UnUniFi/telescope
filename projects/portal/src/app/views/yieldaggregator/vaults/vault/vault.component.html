<div class="mx-auto max-w-screen-xl">
  <div class="text-xl breadcrumbs">
    <ul>
      <li routerLink=".."><a>Vaults</a></li>
      <li>Vault #{{ vault?.vault?.id }}</li>
    </ul>
  </div>
  <div class="w-full md:w-auto mb-8">
    <div class="card bg-base-100 shadow-xl w-full">
      <div class="card-body">
        <h2 class="card-title">
          <ng-container *ngIf="symbolImage">
            <div class="avatar">
              <div class="mask mask-circle w-6 h-6">
                <img src="{{ symbolImage }}" alt="Asset Symbol" />
              </div>
            </div>
          </ng-container>
          <ng-container *ngIf="!symbolImage">
            <span class="material-symbols-outlined">question_mark</span>
          </ng-container>
          <span *ngIf="vault?.vault?.name">{{ vault?.vault?.name }}</span>
          <span *ngIf="!vault?.vault?.name">Vault #{{ vault?.vault?.id }}</span>
          <div class="badge badge-primary">{{ displaySymbol }}</div>
        </h2>
        <p *ngIf="vault?.vault?.description" class="m-8" style="white-space: pre-wrap">
          {{ vault?.vault?.description }}
        </p>
        <div class="overflow-x-auto">
          <table class="table w-full">
            <tbody>
              <tr>
                <td>Vault ID</td>
                <td>{{ vault?.vault?.id }}</td>
              </tr>
              <tr>
                <td class="flex flex-row items-center gap-2">
                  <span>Withdraw Commission Rate</span>
                  <!-- The button to open modal -->
                  <label for="modal-commission" class="label-text cursor-pointer">
                    <span class="material-symbols-outlined">help</span>
                  </label>

                  <!-- Put this part before </body> tag -->
                  <input type="checkbox" id="modal-commission" class="modal-toggle" />
                  <div class="modal modal-bottom sm:modal-middle">
                    <div class="modal-box">
                      <h3 class="font-bold text-lg">What is the withdraw commission rate?</h3>
                      <p class="py-4">
                        This is the commission charged for withdrawals from the vault. In addition
                        to this, in some cases, a commission is imposed on the strategy.
                      </p>
                      <p>
                        For more information of commissions visit
                        <a
                          href="https://docs.ununifi.io/overview/interchain-yield-aggregator/commission"
                          target="_blank"
                        >
                          <u class="text-info">UnUniFi Documentation</u> </a
                        >.
                      </p>
                      <div class="modal-action">
                        <label for="modal-commission" class="btn">Understood</label>
                      </div>
                    </div>
                  </div>
                </td>
                <td>{{ vault?.vault?.withdraw_commission_rate | percent : '1.0-2' }}</td>
              </tr>
              <tr>
                <td class="flex flex-row items-center gap-2">
                  <span>Withdraw Reserve Rate</span>
                  <!-- The button to open modal -->
                  <label for="modal-reserve" class="label-text cursor-pointer">
                    <span class="material-symbols-outlined">help</span>
                  </label>

                  <!-- Put this part before </body> tag -->
                  <input type="checkbox" id="modal-reserve" class="modal-toggle" />
                  <div class="modal modal-bottom sm:modal-middle">
                    <div class="modal-box">
                      <h3 class="font-bold text-lg">What is the withdraw reserve rate?</h3>
                      <p class="py-4">
                        This is the percentage of withdraw reserves to all deposits. The withdraw
                        reserves will be used for withdrawal with zero unbonding time. Additionally,
                        the withdraw reserve rate is used to calculate withdrawal fees.
                      </p>
                      <p>
                        For more information of the withdraw reserve rate visit
                        <a
                          href="https://docs.ununifi.io/overview/interchain-yield-aggregator/withdraw-reserve-rate"
                          target="_blank"
                        >
                          <u class="text-info">UnUniFi Documentation</u> </a
                        >.
                      </p>
                      <div class="modal-action">
                        <label for="modal-reserve" class="btn">Understood</label>
                      </div>
                    </div>
                  </div>
                </td>
                <td>{{ vault?.vault?.withdraw_reserve_rate | percent : '1.0-2' }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="stats stats-vertical md:stats-horizontal">
          <div class="stat">
            <div class="stat-title">APY</div>
            <div class="stat-value text-accent">
              {{ vaultAPY | percent : '1.2-2' }}
            </div>
          </div>
          <div class="stat">
            <div class="stat-title">Total Deposit Amount</div>
            <div class="stat-value text-info">
              {{ totalDepositAmount?.symbolAmount | number : '1.0-2' }} {{ displaySymbol }}
            </div>
            <div class="stat-desc" *ngIf="withdrawReserve?.usdAmount">
              {{ totalDepositAmount?.usdAmount | currency }}
            </div>
          </div>
        </div>
        <div class="stats stats-vertical md:stats-horizontal">
          <div class="stat">
            <div class="stat-title">Total Bonded Amount</div>
            <div class="stat-value text-primary">
              <td>{{ totalBondedAmount?.symbolAmount | number : '1.0-2' }} {{ displaySymbol }}</td>
            </div>
            <div class="stat-desc" *ngIf="totalBondedAmount?.usdAmount">
              {{ totalBondedAmount?.usdAmount | currency }}
            </div>
          </div>
          <div class="stat">
            <div class="stat-title">Total Unbonding Amount</div>
            <div class="stat-value text-secondary">
              {{ totalUnbondingAmount?.symbolAmount | number : '1.0-2' }} {{ displaySymbol }}
            </div>
            <div class="stat-desc" *ngIf="totalUnbondingAmount?.usdAmount">
              {{ totalUnbondingAmount?.usdAmount | currency }}
            </div>
          </div>
          <div class="stat">
            <div class="stat-title">Withdraw Reserve Amount</div>
            <div class="stat-value text-info">
              {{ withdrawReserve?.symbolAmount | number : '1.0-2' }} {{ displaySymbol }}
            </div>
            <div class="stat-desc" *ngIf="withdrawReserve?.usdAmount">
              {{ withdrawReserve?.usdAmount | currency }}
            </div>
          </div>
        </div>
        <!-- <h3 class="mt-4">Historical APY (Demo)</h3>
        <div class="flex w-full justify-center" #chartRef>
          <google-chart
            [title]="chartTitle"
            [type]="chartType"
            [data]="chartData"
            [columns]="chartColumnNames"
            [options]="chartOptions"
          >
          </google-chart>
        </div> -->
      </div>
    </div>
  </div>

  <div class="w-full md:w-auto mb-8">
    <div class="card bg-base-100 shadow-xl w-full">
      <div class="tabs tabs-boxed w-full">
        <a class="tab tab-lg w-1/2" [class.tab-active]="tab === 'mint'" (click)="tab = 'mint'">
          Deposit
        </a>
        <a class="tab tab-lg w-1/2" [class.tab-active]="tab === 'burn'" (click)="tab = 'burn'">
          Withdraw
        </a>
      </div>
      <div class="card-body" *ngIf="tab === 'mint'">
        <form #depositFormRef="ngForm" (submit)="onSubmitDeposit()">
          <div class="form-control">
            <label class="label">
              <span class="label-text">Enter amount</span>
              <span class="label-text-alt flex flex-row gap-2">
                <span class="cursor-pointer" (click)="setMintAmount(0.25)"> 25% </span>
                <span class="cursor-pointer" (click)="setMintAmount(0.5)"> 50% </span>
                <span class="cursor-pointer" (click)="setMintAmount(1)"> 100% </span>
              </span>
            </label>
            <label class="input-group">
              <input
                #depositAmountRef
                #depositAmountNgModelRef="ngModel"
                required
                type="number"
                placeholder="0.000000"
                class="input input-bordered w-full"
                [class]="{
                  'input-error': depositAmountNgModelRef.errors && depositAmountNgModelRef.touched
                }"
                [min]="0"
                [max]="symbolBalancesMap?.[symbol || ''] || 0"
                pattern="^[0-9]*\.?[0-9]{0,6}$"
                [(ngModel)]="mintAmount"
                name="mintAmount"
                (input)="onDepositAmountChange()"
              />
              <span>{{ displaySymbol }}</span>
            </label>
            <span class="label">
              <span class="label-text-alt">Available balance:</span>
              <label class="label-text-alt">
                {{ symbolBalancesMap?.[symbol || ''] || 0 }} {{ displaySymbol }}
              </label>
            </span>
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text">You will receive</span>
            </label>
            <label class="input-group">
              <input
                disabled
                class="input input-bordered w-full"
                value="{{ estimatedMintAmount?.mint_amount?.amount | coinAmount }}"
              />
              <span class="whitespace-nowrap">{{ 'YA-VAULT-' + vault?.vault?.id }}</span>
            </label>
          </div>

          <div class="card-actions justify-end mt-8">
            <button class="btn btn-primary px-8" [disabled]="depositFormRef.invalid">
              Deposit
            </button>
          </div>
        </form>
      </div>
      <div class="card-body" *ngIf="tab === 'burn'">
        <form #withdrawFormRef="ngForm" (submit)="onSubmitWithdraw()">
          <div class="form-control">
            <label class="label">
              <span class="label-text">Enter amount</span>
              <span class="label-text-alt flex flex-row gap-2">
                <span class="cursor-pointer" (click)="setBurnAmount(0.25)"> 25% </span>
                <span class="cursor-pointer" (click)="setBurnAmount(0.5)"> 50% </span>
                <span class="cursor-pointer" (click)="setBurnAmount(1)"> 100% </span>
              </span>
            </label>
            <label class="input-group">
              <input
                #withdrawAmountRef
                #withdrawAmountNgModelRef="ngModel"
                placeholder="0.000000"
                required
                type="number"
                class="input input-bordered w-full"
                [class]="{
                  'input-error': withdrawAmountNgModelRef.errors && withdrawAmountNgModelRef.touched
                }"
                [min]="0"
                [max]="symbolBalancesMap?.['YA-VAULT-'+ vault?.vault?.id || ''] || 0"
                pattern="^[0-9]*\.?[0-9]{0,6}$"
                [(ngModel)]="burnAmount"
                name="burnAmount"
                (input)="onWithdrawAmountChange()"
              />
              <span class="whitespace-nowrap">YA-VAULT-{{ vault?.vault?.id }}</span>
            </label>
            <span class="label">
              <span class="label-text-alt">Available balance:</span>
              <label class="label-text-alt">
                {{ symbolBalancesMap?.['YA-VAULT-'+ vault?.vault?.id] || 0 }}
                {{ 'YA-VAULT-' + vault?.vault?.id }}
              </label>
            </span>
          </div>
          <div class="form-control">
            <label class="label">
              <span class="label-text">You will receive</span>
            </label>

            <label class="input-group">
              <input
                disabled
                class="input input-bordered w-full"
                value="{{ estimatedRedeemAmount?.redeem_amount?.amount | coinAmount }}"
              />
              <span>{{ displaySymbol }}</span>
            </label>
            <span class="label" *ngIf="estimatedRedeemAmount?.share_amount">
              <span class="label-text-alt">
                Total {{ estimatedRedeemAmount?.redeem_amount?.amount | coinAmount }} - Fee
                {{ estimatedRedeemAmount?.fee?.amount | coinAmount }}
              </span>
            </span>
          </div>

          <div class="card-actions justify-end mt-8">
            <button class="btn btn-secondary px-8" [disabled]="withdrawFormRef.invalid">
              Withdraw
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <h2>Strategies Contained in this Vault</h2>
  <div class="flex flex-row flex-wrap -mr-12 -mb-12">
    <div
      *ngFor="let strategy of vault?.vault?.strategy_weights; let i = index"
      class="pr-12 pb-12 w-full md:w-1/2 xl:w-1/3"
    >
      <div class="card bg-base-100 shadow-xl w-full">
        <div class="card-body">
          <h2 class="card-title break-all">
            <ng-container *ngIf="symbolImage">
              <div class="avatar">
                <div class="mask mask-circle w-6 h-6">
                  <img src="{{ symbolImage }}" alt="Asset Symbol" />
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="!symbolImage">
              <span class="material-symbols-outlined">question_mark</span>
            </ng-container>
            <span>
              {{ getStrategyInfo(strategy.strategy_id)?.name }}
            </span>
          </h2>
          <div class="stats">
            <div class="stat">
              <div class="stat-title">Allocation weight</div>
              <div class="stat-value">{{ strategy.weight | percent : '1.0-2' }}</div>
              <div class="stat-desc"></div>
            </div>
          </div>

          <button
            class="btn btn-outline btn-info"
            [routerLink]="[
              '/yield-aggregator/strategies',
              vault?.vault?.denom,
              strategy.strategy_id
            ]"
          >
            View
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
